#!/usr/bin/env php
<?php
error_reporting(-1);

use Icecave\Siphon\Statistics\Serializer;
use Icecave\Siphon\Statistics\StatisticsCollection;
use Icecave\Siphon\Statistics\StatisticsGroup;

require __DIR__ . '/../vendor/autoload.php';

$collection = new StatisticsCollection(
    [
        new StatisticsGroup(
            'regular-season-stats',
            [
                'season-phase-from' => 'Week 1',
                'season-phase-to'   => 'Week 18',
            ],
            [
                'games_played'                           => 16,
                'games_started'                          => 3,
                'interception_returned_longest_yards'    => 3,
                'defense_interceptions'                  => 1,
                'defense_interception_yards'             => 3,
                'defense_solo_tackles'                   => 21,
                'defense_assisted_tackles'               => 7,
                'defense_special_teams_solo_tackles'     => 2,
                'defense_special_teams_assisted_tackles' => 1,
                'defense_sacks'                          => 1.0,
                'defense_sack_yards'                     => 15.0,
                'defense_tackles_for_loss'               => 4.0,
                'defense_pass_defenses'                  => 3,
            ]
        ),
        new StatisticsGroup(
            'post-season-stats',
            [
                'season-phase-from' => 'Wildcard',
                'season-phase-to'   => 'Super Bowl',
            ],
            [
                'games_played'                           => 16,
                'games_started'                          => 3,
                'interception_returned_longest_yards'    => 3,
                'defense_interceptions'                  => 1,
                'defense_interception_yards'             => 3,
                'defense_solo_tackles'                   => 21,
                'defense_assisted_tackles'               => 7,
                'defense_special_teams_solo_tackles'     => 2,
                'defense_special_teams_assisted_tackles' => 1,
                'defense_sacks'                          => 1.0,
                'defense_sack_yards'                     => 15.0,
                'defense_tackles_for_loss'               => 4.0,
                'defense_pass_defenses'                  => 3,
            ]
        ),
    ]
);

$groups  = [];
$regular = [1, &$groups];

foreach ($collection as $group) {
    $groups[$group->key()] = [$group->scopes(), $group->statistics()];
}

$buffer1 = json_encode($regular);
$buffer2 = (new Serializer)->serialize($collection);

foreach ([$buffer1, $buffer2] as $buffer) {
    echo $buffer;
    echo PHP_EOL;
    echo 'length: ' . strlen($buffer);
    echo PHP_EOL;
    echo PHP_EOL;
}
